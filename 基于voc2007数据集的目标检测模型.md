# 基于voc2007数据集的目标检测模型

![image-20210430223450705](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430223450705.png)

## 小组成员

|  姓名  |    学号     |
| :----: | :---------: |
| 张一川 | 20210980014 |
| 王嘉程 | 20210980032 |
| 叶泳标 | 20210980006 |
| 向旭晨 | 20210980007 |

## 1. 源代码地址

https://github.com/Multipluss/nn-mid-term

## 2. 训练模型地址

链接：https://pan.baidu.com/s/1MewCi8yO_OiMQcp5gdMsqw 

提取码：4j31 

## 3. 数据集介绍、划分及预处理

### 3.1 数据集介绍

使用VOC-2007数据集。此数据集包含训练验证集和测试集，共计9963幅图，其中训练验证集有5011幅图，测试集有4952幅图。训练验证集进一步划分为训练集（2501幅）和验证集（2510幅）。图片中包含四项共20类物体，具体情况如下：

**Person:** person；

**Animal:** bird, cat, cow, dog, horse, sheep；

**Vehicle:** aeroplane, bicycle, boat, bus, car, motorbike, train；

**Indoor:** bottle, chair, diningtable, pottedplant, sofa, tv/monitor；

对三个子数据集统计物体数目情况如下：

| 物体名称             | 物体数目        |                |               |
| -------------------- | --------------- | -------------- | ------------- |
|                      | 训练集（train） | 测试集（test） | 验证集（val） |
| aeroplane            | 156             | 311            | 175           |
| bicycle              | 202             | 389            | 216           |
| bird                 | 294             | 576            | 305           |
| boat                 | 208             | 393            | 190           |
| bottle               | 338             | 657            | 296           |
| bus                  | 131             | 254            | 141           |
| car                  | 826             | 1541           | 818           |
| cat                  | 191             | 370            | 198           |
| chair                | 726             | 1374           | 706           |
| cow                  | 185             | 329            | 171           |
| diningtable          | 148             | 299            | 162           |
| dog                  | 271             | 530            | 267           |
| horse                | 207             | 395            | 199           |
| motorbike            | 193             | 369            | 197           |
| person               | 2705            | 5227           | 2742          |
| pottedplant          | 305             | 592            | 320           |
| sheep                | 191             | 311            | 162           |
| sofa                 | 218             | 396            | 207           |
| train                | 158             | 302            | 170           |
| tvmonitor            | 191             | 361            | 176           |
| 物体总数目           | 7844            | 14976          | 7818          |
| 图片数目             | 2501            | 4952           | 2510          |
| 每张图片平均物体数目 | 3.14            | 3.02           | 3.11          |

每张图片可能包含不止一类物品，各个数据集的物体类别分布情况如下所示：

![image-20210430223916285](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430223916285.png)

![image-20210430223920026](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430223920026.png)

训练验证集与测试集的格式相同，组成架构如下：

![image-20210430223955683](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430223955683.png)

Annotations文件夹中存放的是xml格式的标签文件，每一个xml文件都对应于JPEGImages文件夹中的一张图片。ImageSets存放的是不同任务所需的图像数据。JPEGImages文件夹存放图片文件。SegmentationClass和SegmentationObject存放分割任务相关文件，与我们本次训练目标无关。

### 3.2 数据集划分

考虑到测试集（test）包含图片数目较多，选择将测试集（test）作为新的训练集，训练集（train）作为新的测试集。

### 3.3 数据预处理

（1）由于数据集中包含大量与本次任务目标无关的信息，因此对annotation信息进行筛选，得到与物品识别相关的数据，即物品位置和种类信息。

（2）由于一张图片包含多个物品，因此选择面积最大的物体框，作为输入，即每张图片输入一个物品。

## 4. 网络结构

### 模型1：RESNET

![image-20210430224107482](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224107482.png)

###  模型2：去除残差的简单网络

![image-20210430224157286](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224157286.png)

### 模型3：ALEXNET

![image-20210430224212533](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224212533.png)

### 模型4：去除池化的ALEXNET

![image-20210430224228619](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224228619.png)

### 模型5：拥有更大batch size的ALEXNET

![image-20210430224247926](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224247926.png)

## 5. 其他参数

| 模型        | 模型1 | 模型2 | 模型3 | 模型4 | 模型5 |
| ----------- | ----- | ----- | ----- | ----- | ----- |
| Batch  size | 64    | 64    | 64    | 64    | 128   |
| 优化器      | adam  | adam  | adam  | gsd   | gsd   |
| Epoch       | 50    | 50    | 100   | 100   | 100   |

```python
loss function：
loss={'bbox_output': keras.losses.MeanAbsoluteError(),
     'class_output':keras.losses.SparseCategoricalCrossentropy()}
其中'bbox_output'表示位置判断误差，'class_output'表示物品识别误差，分别赋予1:30的权重。

```

## 6. 评价指标

| 模型  | tensorboard训练loss曲线                                      | ACC曲线                                                      |
| ----- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 模型1 | ![image-20210430224401526](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224401526.png) | ![image-20210430224405271](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224405271.png) |
| 模型2 | ![image-20210430224417249](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224417249.png) | ![image-20210430224419632](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224419632.png) |
| 模型3 | ![image-20210430224421689](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224421689.png) | ![image-20210430224423517](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224423517.png) |
| 模型4 | ![image-20210430224432952](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224432952.png) | ![image-20210430224435173](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224435173.png) |
| 模型5 | ![image-20210430224534881](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224534881.png) | ![image-20210430224537113](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224537113.png) |

## 7. 结果可视化

### 7.1 关于卷积层的可视化

经过了神经网络后，各层的网络会从原始图像中学习到什么？

我们输入了一个简单的四层的神经网络，按照卷积层 -> 激活函数 -> 池化重复构建得到最终的网络结构。

![image-20210430224727602](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224727602.png)

 我们输入的图片如下，是一个375×500×3的jpg格式图片：

![image-20210430224739392](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224739392.png)

在每一层操作后进行可视化操作得到每一层对应的神经元所学习的网络。

在第一层网络中，所得到的特征如下：

![image-20210430224819995](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224819995.png)

将以上特征拼合一起可以得到如下：

![image-20210430224825883](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224825883.png)

经历第二层网络后得到如下：

![image-20210430224845137](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224845137.png)

将对应特征加总融合如下：

![image-20210430224850231](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224850231.png)

第三层网络如下：

![image-20210430224856488](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224856488.png)

融合得到：

![image-20210430224901982](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224901982.png)

最终层学习得到的特征如下：

![image-20210430224915063](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224915063.png)

合并后得到：

![image-20210430224922266](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430224922266.png)

由以上4个分层绘制的图片，通过对比原图可以归纳出以下因素：

在浅层的网络提取的是纹理、轮廓、形状等大致特征；深层网络提取的是细节特征；浅层网络包含更多的特征，也具备提取关键特征的能力（即特征图中包含了细节重要的元素）。相对而言，层数跃升，提取的网络越具有代表性，而总体而言，图像的分辨率是越来越小的，为了对细节进行刻画，图片的模糊性增强。



### 7.2 模型结果的可视化

#### （1）实际情况



![image-20210430225014519](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430225014519.png)

#### （2）预测结果

![image-20210430225042913](C:\Users\jiacheng\AppData\Roaming\Typora\typora-user-images\image-20210430225042913.png)

上表为实际情况与预测情况的对比图，总体预测效果尚可，但仍然会出现一些预测失误，主要存在的问题有：1、图片中存在多个物体，会影响模型物体框的预测，进而导致识别到非目标物体并且物体识别错误；2、图片中存在多个物体，会影响模型物体框的预测，进而导致识别到非目标物体但物体识别正确；3、物体框预测准确，但对物体框内的物体识别错误。